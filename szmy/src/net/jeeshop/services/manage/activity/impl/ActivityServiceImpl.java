package net.jeeshop.services.manage.activity.impl;import java.util.LinkedList;import java.util.List;import org.apache.commons.lang.StringUtils;import net.jeeshop.core.MyCommonDao;import net.jeeshop.core.ServersManager;import net.jeeshop.services.manage.activity.ActivityService;import net.jeeshop.services.manage.activity.bean.Activity;import net.jeeshop.services.manage.activity.dao.ActivityDao;import net.jeeshop.services.manage.product.ProductService;import net.jeeshop.services.manage.product.bean.Product;public class ActivityServiceImpl extends ServersManager<Activity> implements		ActivityService {	private ActivityDao activityDao;	private MyCommonDao myCommonDao;	private ProductService productService;		public ProductService getProductService() {		return productService;	}	public void setProductService(ProductService productService) {		this.productService = productService;	}		public void setMyCommonDao(MyCommonDao myCommonDao) {		this.myCommonDao = myCommonDao;	}	public void setActivityDao(ActivityDao activityDao) {		this.activityDao = activityDao;	}		/**	 * 新增活动	 */	@Override	public int insert(Activity e) {		if(StringUtils.isBlank(e.getCompName())){			List<Object> list = myCommonDao.executeSql(1, "select name from t_company where createAccount='"+e.getCreateAccount()+"'");			e.setCompName(list.get(0).toString());		}		int activityID = super.insert(e);		e.setId(String.valueOf(activityID));		if(e.getStatus().equals("y")){			Product pro = new Product();			pro.setActivityID(e.getId());			pro.setActivityType(e.getActivityType());				String[] productIDArr = e.getProductID().split(",");				if(pro.getProductIds()==null){					pro.setProductIds(new LinkedList<String>());				}				for(int i=0;i<productIDArr.length;i++){					pro.getProductIds().add(productIDArr[i].trim());				}			productService.updateProductBindActivityId(pro);		}		return activityID;	}@Overridepublic int delete(Activity e) {	// TODO Auto-generated method stub	myCommonDao.executeSql(2, "update t_product set activityID=null,activityType=null where activityID="+e.getId());	return super.delete(e);}	@Override	public int deletes(String[] ids) {		// TODO Auto-generated method stub		String idss="";		for (String id : ids) {			idss=idss+","+id;		}		myCommonDao.executeSql(2, "update t_product set activityID=null,activityType=null where activityID in ("+idss.substring(1)+")");		return super.deletes(ids);	}	/**	 * 修改活动	 */	@Override	public int update(Activity e) {		if(e.getStatus().equals("y")){		myCommonDao.executeSql(2, "update t_product set activityID=null,activityType=null where activityID="+e.getId());		Product pro = new Product();		pro.setActivityID(e.getId());		pro.setActivityType(e.getActivityType());		String[] productIDArr = e.getProductID().split(",");		if(pro.getProductIds()==null){			pro.setProductIds(new LinkedList<String>());		}		for(int i=0;i<productIDArr.length;i++){			pro.getProductIds().add(productIDArr[i].trim());		}		pro.setActivityBuyCount(0);		productService.updateProductBindActivityId(pro);		}else{			myCommonDao.executeSql(2, "update t_product set activityID=null,activityType=null where activityID="+e.getId());		}		return super.update(e);	}		private void updateProductBindActivityId(Activity e ,String hzlxs) {		Product pro = new Product();		pro.setActivityID(e.getId());		pro.setActivityType(e.getActivityType());		if(e.getProductID()!=null){			String[] productIDArr = e.getProductID().split(",");		if(pro.getProductIds()==null){			pro.setProductIds(new LinkedList<String>());		}						for(int i=0;i<productIDArr.length;i++){			pro.getProductIds().add(productIDArr[i].trim());		}		}		if(pro.getCompanyTypes()==null){			pro.setCompanyTypes(new LinkedList<String>());		}		String[] companyTypeArr = hzlxs.split(",");		for(int i=0;i<companyTypeArr.length;i++){			pro.getCompanyTypes().add(companyTypeArr[i].trim());		}		productService.updateProductBindActivityId(pro);			}	@Override	public void insertComp(Activity e, String allProduct, String pid) {		// TODO Auto-generated method stub		int activityID = super.insert(e);		e.setId(String.valueOf(activityID));		if(e.getStatus().equals("y")){						Product pro = new Product();			pro.setActivityID(e.getId());			pro.setActivityType(e.getActivityType());			if(StringUtils.isNotEmpty(allProduct)){				pro.setCompID(pid);			}else{				String[] productIDArr = e.getProductID().split(",");				if(pro.getProductIds()==null){					pro.setProductIds(new LinkedList<String>());				}				for(int i=0;i<productIDArr.length;i++){					pro.getProductIds().add(productIDArr[i].trim());				}			}			pro.setActivityBuyCount(0);			productService.updateProductBindActivityId(pro);				}			}		@Override	public Activity selectByPid(String productID){		return activityDao.selectByPid(productID);	}}