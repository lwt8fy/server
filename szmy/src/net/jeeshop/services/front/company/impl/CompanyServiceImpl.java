package net.jeeshop.services.front.company.impl;import java.util.List;import net.jeeshop.core.ServersManager;import net.jeeshop.services.front.company.CompanyService;import net.jeeshop.services.front.company.GetProvince;import net.jeeshop.services.front.company.bean.Company;import net.jeeshop.services.front.company.dao.CompanyDao;import org.apache.commons.lang.StringUtils;import org.slf4j.Logger;import org.slf4j.LoggerFactory;public class CompanyServiceImpl extends ServersManager<Company> implements		CompanyService {	private static final Logger logger = LoggerFactory			.getLogger(CompanyServiceImpl.class);	private CompanyDao companyDao;	public CompanyDao getCompanyDao() {		return companyDao;	}	public void setCompanyDao(CompanyDao companyDao) {		this.companyDao = companyDao;	}	/**	 * 添加企业信息	 */	@Override	public int insert(Company e) {		int companyID = super.insert(e);		return companyID;	}	/**	 * 更新企业信息	 */	@Override	public int update(Company e) {		super.update(e);		return 1;	}	/**	 * 批量删除企业 包括: 1、企业表数据。 2、属性关联表数据。 3、企业图片。 这个不一定要删除，因为有可能同一张图片被多处引用了。	 * 	 * @param ids	 * @return	 */	@Override	public int deletes(String[] ids) {		if (ids != null && ids.length > 0) {			for (int i = 0; i < ids.length; i++) {				String id = ids[i];				logger.error("删除企业deleteById.id=" + id);				if (StringUtils.isBlank(id)) {					throw new NullPointerException();				}				companyDao.deleteById(Integer.parseInt(id));			}		}		return 0;	}				//根据ip查出企业	@Override	public Company ipCompany(String	 ip ,String encodingString){		GetProvince addressUtils = new GetProvince(); 		Company company=new Company();		String urlStr = "http://ip.taobao.com/service/getIpInfo.php";		String returnStr =null;		try{		  returnStr = addressUtils.getResult(urlStr, "ip="+ip, encodingString);  		}catch (Exception e) {			logger.error("获取地址出错!");		}		  if (returnStr != null) {  		   String[] temp = returnStr.split(",");  		   if(temp.length<3){  		    return null;//无效IP，局域网测试  		   }		   String region_city= (temp[8].split(":"))[1].replaceAll("\"", "");  		   String region_area= (temp[10].split(":"))[1].replaceAll("\"", "");		   if(StringUtils.isBlank(region_city)){region_city="无数据"; }		   if(StringUtils.isBlank(region_area)){region_area="无数据"; }		   System.out.println("region_city+++++++++++++++++++++++++++++++"+region_city);		   System.out.println("region_area+++++++++++++++++++++++++++++++"+region_area);			   company.setCity(region_city);			   company.setArea(region_area);	        List<Company> companylist=selectList(company);	        if(companylist==null||companylist.size()==0){	        	company.setArea(null);	        	companylist=selectList(company);	        	if(companylist!=null&&companylist.size()>0){	        		return companylist.get(0);	        	}	        }else{	        	return companylist.get(0);	        }		  }		  return null;	}}