package net.jeeshop.web.action.manage.integral;import net.jeeshop.core.BaseAction;import net.jeeshop.core.KeyValueHelper;import net.jeeshop.core.ManageContainer;import net.jeeshop.core.system.bean.User;import net.jeeshop.services.common.Integral;import net.jeeshop.services.front.account.AccountService;import net.jeeshop.services.front.account.bean.Account;import net.jeeshop.services.manage.Integral.service.IntegralService;import net.jeeshop.services.manage.company.bean.Company;public class IntegralAction extends BaseAction<Integral> {	private static final long serialVersionUID = 1L;	private IntegralService integralService;	private AccountService accountService;	private String message;			public void setAccountService(AccountService accountService) {		this.accountService = accountService;	}	public String getMessage() {		return message;	}	public void setMessage(String message) {		this.message = message;	}	public void setIntegralService(IntegralService integralService) {		this.integralService = integralService;	}			@Override	public String insert() throws Exception {		// TODO Auto-generated method stub		User u = (User) getSession().getAttribute(ManageContainer.manage_session_user_info);		Company company=(Company) getSession().getAttribute(ManageContainer.manage_session_company_info);		if(company==null){		message="您还未申请企业!";		return selectList();		}		e.setUserID(u.getId());		e.setCompID(company.getId());		e.setCompName(company.getName());		e.setStatus("1");		e.setRemaining(e.getIntegral());		 super.insert();		 e=new Integral();		 message="提交审核成功,请等待审核!";		return selectList();	}		public String updateStatus() throws Exception{		User user = (User) getRequest().getSession().getAttribute(				ManageContainer.manage_session_user_info);		if (user == null) {			throw new NullPointerException("登陆超时！");		}		if(!user.getRid().equals("1")&&!user.getRid().equals(KeyValueHelper.get("checkProductRid"))){			throw new NullPointerException("权限不足！");		}		getServer().update(e);		Integral ig = integralService.selectById(e.getId());		Account acc = accountService.selectById(ig.getUserID());				Account a2=new Account();		a2.setId(acc.getId());		a2.setMoney((acc.getMoney()==null?0:acc.getMoney())+ig.getIntegral());		accountService.updateMoney(a2);				message="操作成功！";		e=new Integral();								return selectList();	}	@Override	public String selectList() throws Exception {		// TODO Auto-generated method stub		User u = (User) getSession().getAttribute(ManageContainer.manage_session_user_info);		if(!u.getRid().equals("1")&&!u.getRid().equals(KeyValueHelper.get("checkProductRid"))){		e.setUserID(u.getId());		}		return super.selectList();	}	@Override	protected void selectListAfter() {		pager.setPagerUrl("email!selectList.action");	}	@Override	public String toAdd() throws Exception {		// TODO Auto-generated method stub		Company company=(Company) getSession().getAttribute(ManageContainer.manage_session_company_info);		if(company==null){		message="您还未申请企业!";		return selectList();		}		return super.toAdd();	}	@Override	public Integral getE() {		return this.e;	}	@Override	public void prepare() throws Exception {		if (this.e == null) {			this.e = new Integral();		}	}	@Override	public void insertAfter(Integral e) {		e.clear();	}}